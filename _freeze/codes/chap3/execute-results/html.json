{
  "hash": "abea0e9f9887197f48f61034a9c84d87",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"3 Validation du mod√®le\"\ntoc: true\n---\n\n::: {#85e1def0 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport statsmodels.formula.api as smf\nimport statsmodels.api as sm\nimport matplotlib.pyplot as plt\nimport scipy.stats as stats\nfrom statsmodels.nonparametric.smoothers_lowess import lowess\n```\n:::\n\n\n::: {#1a1443c9 .cell execution_count=2}\n``` {.python .cell-code}\nozone = pd.read_csv(\"../donnees/ozone_long.txt\", header = 0, sep = \";\")\nmod_lin6v = smf.ols(\"O3 ~ T6+T12+Ne12+Ne15+Vx+O3v\", data=ozone).fit()\n```\n:::\n\n\n::: {#9c39fd4f .cell execution_count=3}\n``` {.python .cell-code}\ninfl = mod_lin6v.get_influence()\nindex = pd.Series(range(1, ozone.shape[0]+1))\nresloess = sm.nonparametric.lowess(infl.resid_studentized_external,index)\n```\n:::\n\n\n::: {#3c6f3dc8 .cell execution_count=4}\n``` {.python .cell-code}\nplt.plot(index, infl.resid_studentized_external,\"+k\")\nplt.plot(resloess[:,0], resloess[:,1],\"r\")\nax = plt.gca()\nax.axhline(y=-2)\nax.axhline(y=2)\n```\n\n::: {.cell-output .cell-output-display}\n![](chap3_files/figure-html/cell-5-output-1.png){width=569 height=411}\n:::\n:::\n\n\n::: {#1cf68b03 .cell execution_count=5}\n``` {.python .cell-code}\n#df = ozone.shape[0] - 3\nsm.qqplot(infl.resid_studentized_external, \\\n    stats.t,distargs=(ozone.shape[0]-infl.k_vars-1,), line='s')\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n![](chap3_files/figure-html/cell-6-output-1.png){width=587 height=429}\n:::\n\n::: {.cell-output .cell-output-display}\n![](chap3_files/figure-html/cell-6-output-2.png){width=587 height=429}\n:::\n:::\n\n\n::: {#f09d75ad .cell execution_count=6}\n``` {.python .cell-code}\ncook, pval =infl.cooks_distance\nn, p =ozone.shape\nfig = plt.figure()\nplt.bar(index, cook, lw=2, color='k')\nfig.tight_layout()\n```\n\n::: {.cell-output .cell-output-display}\n![](chap3_files/figure-html/cell-7-output-1.png){width=662 height=469}\n:::\n:::\n\n\n::: {#815181b5 .cell execution_count=7}\n``` {.python .cell-code}\nhii = infl.hat_matrix_diag\nseuil1 = 3*p/n\nseuil2 = 2*p/n\nplt.bar(index, hii, lw=2, color='k')\nax = plt.gca()\nax.axhline(y=seuil1, color='r', ls=':')\nax.axhline(y=seuil2, color='r', ls='--')\nfig.tight_layout()\n```\n\n::: {.cell-output .cell-output-display}\n![](chap3_files/figure-html/cell-8-output-1.png){width=588 height=411}\n:::\n:::\n\n\n::: {#d73d0a14 .cell execution_count=8}\n``` {.python .cell-code}\nfig = sm.graphics.plot_ccpr_grid(mod_lin6v)\nfig.suptitle(\"\", fontsize=16)\nmarker_size = 2\nfor ax in fig.axes:\n    ax.set_ylabel('')\n    ax.lines[0].set_color('black')\n    for line in ax.get_lines():\n        line.set_markersize(marker_size)\n\nplt.subplots_adjust(top=0.99, bottom=-0.5, left=0.01, right=0.99, hspace=0.1, wspace=0.4)\nfig.tight_layout()\n```\n\n::: {.cell-output .cell-output-display}\n![](chap3_files/figure-html/cell-9-output-1.png){width=662 height=374}\n:::\n:::\n\n\n::: {#3d5bfa48 .cell execution_count=9}\n``` {.python .cell-code}\ndef plot_ccpr_grid_with_loess(mod, exog_idx=None, grid=None, fig=None):\n    fig = sm.graphics.plot_ccpr_grid(mod, exog_idx, grid, fig)\n    fig.suptitle(\"\", fontsize=16)\n    marker_size = 2\n    for ax in fig.axes:\n        x = ax.lines[0].get_xdata()\n        y = ax.lines[0].get_ydata()\n        ax.set_ylabel('')\n        ax.lines[0].set_color('black')\n        for line in ax.get_lines():\n            line.set_markersize(marker_size)\n        # Rajout de loess en rouge\n        smooth = lowess(y, x, frac=2/3)\n        ax.plot(smooth[:, 0], smooth[:, 1], color='red', lw=2)\n    return fig\n\nfig = plot_ccpr_grid_with_loess(mod_lin6v)\nfig.tight_layout()\n```\n\n::: {.cell-output .cell-output-display}\n![](chap3_files/figure-html/cell-10-output-1.png){width=643 height=374}\n:::\n:::\n\n\n",
    "supporting": [
      "chap3_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}